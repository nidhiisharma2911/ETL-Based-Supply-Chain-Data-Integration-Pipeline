# Power BI Report Spec — ETL Monitoring (etl_monitoring.pbix)

This document describes how to build `etl_monitoring.pbix` in Power BI Desktop using the processed outputs in this repo.

## Data Sources
- CSVs under `data/processed/`:
  - `fact_sales.csv` (fields: SaleID, Date, CustomerID, ProductID, Quantity, Price, Total)
  - `inventory_summary.csv` (fields: ProductID, total_stock, last_inventory_date, locations)
  - `logistics_kpi.csv` (status_* columns and percent_delivered)
- Or use the SQLite DB `supply_chain.db` (tables: `fact_sales`, `inventory_summary`, `logistics_kpi`).

## Power Query (recommended transforms)
1. Get Data → CSV / SQLite and load the three tables.
2. For `fact_sales`:
   - Trim column names; change `Date` to Date type (use locale or multiple parse attempts if needed).
   - Remove duplicates by `SaleID`.
   - Replace empty `Quantity`/`Price` with 0, change types to Whole Number / Decimal.
   - Add `Total` = `Quantity` * `Price` if missing.
3. For `inventory_summary`:
   - Parse `last_inventory_date` to Date.
   - Ensure `total_stock` is Whole Number.
4. For `logistics_kpi`:
   - Ensure status columns are Whole Number and `percent_delivered` is Decimal.
5. Load to model (disable Auto Date/Time if preferred).

## Data Model
- No relationships required if visuals use merged queries; otherwise relate by `ProductID` between `fact_sales` and `inventory_summary`.

## Suggested DAX Measures
- Total Sales = SUM(fact_sales[Total])
- Total Units = SUM(fact_sales[Quantity])
- Inventory On Hand = SUM(inventory_summary[total_stock])
- Avg Daily Sales = CALCULATE([Total Units], DATESINPERIOD(fact_sales[Date], MAX(fact_sales[Date]), -30, DAY)) / 30
- Days Of Inventory = DIVIDE([Inventory On Hand], [Avg Daily Sales], BLANK())
- Percent Delivered = AVERAGE(logistics_kpi[percent_delivered])

If `logistics_kpi` contains separate status columns (e.g., `status_delivered`), create:
- Shipments Delivered = SUM(logistics_kpi[status_delivered])

## Report Pages & Visuals
1. Overview (page)
   - Top row: KPI cards — `Total Sales`, `Total Units`, `Inventory On Hand`, `Percent Delivered`.
   - Data Freshness: Table visual showing file names and last modified timestamps (Power BI doesn't read file mtime from CSV directly—use `Date` fields or add a `data_freshness` CSV generated by ETL containing filenames and modified times). Alternatively, reference the Streamlit output for freshness.
   - Sales vs Inventory: Clustered bar chart — Axis: `ProductID`, Values: `total_stock` and `Total Units` (from a merged table or measure), stacked/grouped to compare.
   - Delivery Delays: Donut chart of status counts (use `status_*` columns converted to rows via Unpivot in Power Query) + KPI card `Percent Delivered`.

2. Trends (page)
   - Line chart: Weekly `Total Sales` (use a Date table, group by week). Include moving average line (use DAX measure: `Sales_MA_4W = AVERAGEX(DATESINPERIOD(Date[Date], LASTDATE(Date[Date]), -28, DAY), [Total Sales])`).
   - Slicer: Date range and `ProductID`.

3. Data Quality (page)
   - Table: Row counts, null counts per column (create via Power Query or a small aggregated CSV from ETL).
   - Recent Duplicates: list `SaleID` duplicates (query created in Power Query before loading).

## Visual Formatting & Interactivity
- Use bookmarks to toggle between detailed and summary views.
- Use tooltip pages to show sales details when hovering over Product bars.
- Configure slicers for `ProductID`, `Location` (from `inventory_summary` locations), and date range.

## Deployment & Scheduled Refresh
- Publish `.pbix` to Power BI Service.
- Configure Gateway/Refresh if using a local SQLite/CSV — for CSVs, place them in a cloud location (OneDrive/SharePoint) or use an on-prem gateway that can access the repo path.

## Example Build Steps (Power BI Desktop)
1. Open Power BI Desktop → Get Data → More → choose `Text/CSV` or `SQLite`.
2. Load `fact_sales.csv`, `inventory_summary.csv`, `logistics_kpi.csv`.
3. In Power Query: apply transforms above (parse dates, change types, remove duplicates, unpivot statuses).
4. Close & Apply.
5. Create calculated measures (DAX) in the Model view.
6. Build visuals per pages described.
7. Save report as `etl_monitoring.pbix`.

## File/Field Mapping Summary
- `fact_sales.csv` → table `fact_sales` (SaleID, Date, CustomerID, ProductID, Quantity, Price, Total)
- `inventory_summary.csv` → table `inventory_summary` (ProductID, total_stock, last_inventory_date, locations)
- `logistics_kpi.csv` → table `logistics_kpi` (status_* columns, percent_delivered)

## Notes / Limitations
- I cannot generate a real Power BI `.pbix` file here (proprietary binary). The Streamlit app included in this repo is a cross-platform alternative that replicates the requested visuals.
- Use this spec to build `etl_monitoring.pbix` quickly in Power BI Desktop.

---
If you want, I can also export a step-by-step Power Query script (M code) and the exact DAX formulas ready to paste into Power BI. Tell me which you'd prefer next.
